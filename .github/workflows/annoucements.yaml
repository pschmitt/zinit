name: ðŸ“£ Annoucements
on:
  discussion:
    types: [created, edited, pinned]


jobs:
  gitter-im-broadcast:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“£ Broadcast announcement
        id: announcement
        if: ${{ github.event.discussion.category.name == 'Announcements' }}
        run: |
          TITLE="$(jq -er '.discussion.title' "$GITHUB_EVENT_PATH")"
          BODY="$(jq -er '.discussion.body' "$GITHUB_EVENT_PATH")"
          URL="$(jq -er '"https://github.com/" + .discussion.html_url' "$GITHUB_EVENT_PATH")"
          echo -e "New announcement: ${TITLE}\n${BODY}\nURL: ${URL}" >&2
          echo "::set-output name=announcement-title::${TITLE}"
          echo "::set-output name=announcement-body::${BODY}"
          echo "::set-output name=announcement-url::${URL}"

      - id: initial
        uses: juztcode/gitter-github-action@v1
        if: success()
        with:
          room-id: ${{ secrets.GITTER_ROOM_ID }}
          token: ${{ secrets.GITTER_PERSONAL_ACCESS_TOKEN }}
          text: |
            ** ðŸ“£ ${{ steps.annoucement.outputs.announcement-title }}**
            ${{ steps.annoucement.outputs.announcement-body }}

            url: ${{ steps.annoucement.outputs.announcement-url }}
